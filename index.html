<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego de Carreteras</title>
<style>
  body { display: flex; height: 100vh; margin: 0; font-family: Arial, sans-serif; }
  #sidebar { width: 250px; background: #f9f9f9; padding: 10px; box-sizing: border-box; border-right: 1px solid #ccc; overflow-y: auto; }
  #mapContainer { flex: 1; display: flex; justify-content: center; align-items: center; background: #ddd; }
  svg { border: 1px solid #333; max-width: 95%; max-height: 95%; background: #f2f2f2; }
  .road { stroke-width: 3; fill: none; stroke: red; }
  .road.correct { stroke: green; }
  .btnRoad { display: block; width: 100%; padding: 6px; margin: 2px 0; border: 1px solid #ccc; background: #fff; cursor: pointer; text-align: left; }
  .btnRoad:hover { background: #eee; }
  .btnRoad.correct { background: #9f9; }
  .btnRoad.wrong { background: #f99; }
</style>
</head>
<body>

<div id="sidebar">
  <h2>Juego de Carreteras</h2>
  <p>Haz clic en la carretera correcta:</p>
  <div id="buttonsContainer"></div>
  <p id="result"></p>
</div>

<div id="mapContainer">
  <svg id="map" viewBox="0 0 1000 800">
    <image href="MapaBase.png" x="0" y="0" width="1000" height="800"/>
    <g id="roadsLayer"></g>
  </svg>
</div>

<script>
let roads = [];
let targetRoad = null;
let answeredCorrect = new Set();

const roadsLayer = document.getElementById("roadsLayer");
const buttonsContainer = document.getElementById("buttonsContainer");
const result = document.getElementById("result");

// --- CARGAR JSON AUTOMÁTICAMENTE ---
fetch("carreteras.json")
  .then(res => res.json())
  .then(content => {
    // Ordenar alfabéticamente
    roads = (content.carreteras || []).sort((a, b) =>
      a.nombre.localeCompare(b.nombre, "es", { sensitivity: "base" })
    );
    createButtons();
    startGame();
  })
  .catch(err => {
    result.textContent = "Error cargando carreteras.json: " + err;
  });

// --- CREAR BOTONES ---
function createButtons(){
  buttonsContainer.innerHTML = "";
  roads.forEach(r => {
    const btn = document.createElement("button");
    btn.textContent = r.nombre;
    btn.className = "btnRoad";
    btn.onclick = () => checkAnswer(r, btn);
    buttonsContainer.appendChild(btn);
  });
}

// --- INICIAR JUEGO ---
function startGame(){
  if (roads.length === 0) return;
  // Elegir carretera que aún no esté acertada
  const candidates = roads.filter(r => !answeredCorrect.has(r.nombre));
  if (candidates.length === 0){
    result.textContent = "🎉 ¡Has acertado todas las carreteras!";
    return;
  }
  targetRoad = candidates[Math.floor(Math.random() * candidates.length)];
  drawRoad(targetRoad, "road"); // dibujar en rojo
  result.textContent = "Encuentra la carretera resaltada en rojo.";
}

// --- DIBUJAR CARRETERA ---
function drawRoad(road, cssClass){
  roadsLayer.innerHTML = "";
  // Dibujar todas las que ya están correctas en verde
  roads.forEach(r => {
    if (answeredCorrect.has(r.nombre)){
      r.segmentos.forEach(seg => {
        const poly=document.createElementNS("http://www.w3.org/2000/svg","polyline");
        poly.setAttribute("points", seg.puntos.map(p=>p.join(",")).join(" "));
        poly.setAttribute("class","road correct");
        roadsLayer.appendChild(poly);
      });
    }
  });
  // Dibujar la carretera actual (si no está ya acertada)
  if (!answeredCorrect.has(road.nombre)){
    road.segmentos.forEach(seg=>{
      const poly=document.createElementNS("http://www.w3.org/2000/svg","polyline");
      poly.setAttribute("points", seg.puntos.map(p=>p.join(",")).join(" "));
      poly.setAttribute("class",cssClass);
      roadsLayer.appendChild(poly);
    });
  }
}

// --- COMPROBAR RESPUESTA ---
function checkAnswer(road, button){
  if (!targetRoad) return;
  if (road.nombre === targetRoad.nombre){
    // Correcto
    button.classList.remove("wrong");
    button.classList.add("correct");
    answeredCorrect.add(road.nombre);
    drawRoad(targetRoad, "road correct");
    // resetear rojos
    document.querySelectorAll(".btnRoad.wrong").forEach(b => b.classList.remove("wrong"));
    startGame();
  } else {
    // Incorrecto
    if (!button.classList.contains("correct")){
      button.classList.add("wrong");
    }
  }
}
</script>

</body>
</html>
